<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<title>NexusAdapter • connectOS</title>
<style>
  body{margin:0;background:#000;color:#0f0;font-family:system-ui}
  #container{width:100vw;height:100vh;position:relative;overflow:hidden}
  iframe,canvas{width:100%;height:100%;border:none}
  #controls{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:#0008;padding:15px;border-radius:20px;display:none}
</style>
</head>
<body>

<div id="container">
  <iframe id="target"></iframe>
</div>

<div id="controls">
  <button onclick="rotate()">Rotate</button>
  <button onclick="touchMode()">Touch Mode</button>
  <button onclick="desktopMode()">Desktop Mode</button>
</div>

<script>
// NexusAdapter — transforma qualquer app em qualquer dispositivo
const PHI = 1.618
let mode = 'auto'

function detectDevice() {
  const isMobile = /Mobi|Android|iPhone/i.test(navigator.userAgent)
  const hasTouch = 'ontouchstart' in window
  return {isMobile, hasTouch}
}

function adaptApp(url) {
  const device = detectDevice()
  const iframe = document.getElementById('target')
  
  if (url.includes('.exe') || url.includes('.msi')) {
    nexusSpeak("Executável Windows detectado. Transformando em app mobile...")
    iframe.src = `runtimes/wine-mobile.html?url=${url}`
    applyMobileUI()
  }
  else if (url.includes('.apk')) {
    if (device.isMobile) {
      nexusSpeak("APK nativo. Rodando direto.")
      iframe.src = url
    } else {
      nexusSpeak("APK no PC Transformando em janela desktop...")
      iframe.src = `runtimes/apk-desktop.html?file=${url}`
      applyDesktopUI()
    }
  }
  else if (url.includes('.html') || url.includes('http')) {
    nexusSpeak("Site web. Adaptando Φ-experience...")
    iframe.src = url
    autoMode()
  }
}

function applyMobileUI() {
  document.body.style.transform = 'scale(1)'
  document.getElementById('controls').style.display = 'block'
}
function applyDesktopUI() {
  document.body.style.overflow = 'hidden'
  document.body.style.cursor = 'default'
}

// Funções de controle
function rotate() { document.body.style.transform = 'rotate(90deg)' }
function touchMode() { document.body.style.touchAction = 'manipulation' }
function desktopMode() { document.body.style.cursor = 'default' }

function nexusSpeak(text){
  parent.postMessage({type:'nexus',text},'*')
}

// Exemplo automático (quando você arrastar um arquivo)
window.addEventListener('message', e => {
  if (e.data.type === 'run') adaptApp(e.data.url)
})
</script>
</body></html>
