<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>OSAI • osai</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
 5>
  body,html{margin:0;height:100%;background:#000;color:#0f0;font-family:system-ui;display:flex;flex-direction:column}
  #welcome{font-size:1.8em;text-align:center;margin:2rem 1rem}
  #messages{flex:1;overflow-y:auto;padding:1rem}
  #input-area{display:flex;gap:8px;padding:10px}
  input{background:#111;border:1px solid #0f0;color:#0f0;padding:15px;flex:1;font-size:18px}
  button{background:#0f0;color:#000;border:none;padding:15px 25px;font-weight:bold}
  select{position:fixed;top:10px;right:10px;background:#000;color:#0f0;border:1px solid #0f0;padding:8px}
</style>
</head>
<body>
<div id="welcome">Loading OSAI...</div>
<div id="messages"></div>
<div id="input-area">
  <input id="user-input" placeholder="What do you want to create?">
  <button onclick="send()">Send</button>
</div>

<script type="module">
import { createOllama } from 'https://cdn.jsdelivr.net/npm/ollama-browser@0.3.6/+esm'

const ollama = createOllama()
let txt = {}

async function loadLang(code) {
  try {
    txt = await (await fetch(`../lang/${code}.json`)).json()
  } catch { txt = await (await fetch('../lang/en.json')).json() }
  document.getElementById('welcome').innerText = txt.welcome
  document.getElementById('user-input').placeholder = txt.placeholder || "Talk to OSAI..."
}
loadLang((navigator.language||'en').split('-')[0])

document.body.insertAdjacentHTML('beforeend', `
  <select onchange="loadLang(this.value)">
    <option value="en">English</option>
    <option value="pt">Português</option>
    <option value="es">Español</option>
    <option value="hi">हिंदी</option>
    <option value="ar">العربية</option>
    <option value="bn">বাংলা</option>
    <option value="ru">Русский</option>
    <option value="zh">中文</option>
  </select>
`)

async function send() {
  const input = document.getElementById('user-input')
  const msg = input.value.trim()
  if (!msg) return
  addMessage(msg, 'user')
  input.value = ''

  const response = await ollama.chat({
    model: 'OSAI-2b-q4',
    messages: [{role:'user', content:msg}],
    stream: true
  })

  let botMsg = ''
  for await (const part of response) {
    botMsg += part.message.content
    addMessage(botMsg, 'bot', true)
  }
}

function addMessage(text, sender, streaming=false) {
  let div = document.getElementById(sender)
  if (!div) {
    div = document.createElement('div')
    div.id = sender
    div.style = sender==='user' ? 'text-align:right;margin:1rem' : 'margin:1rem'
    document.getElementById('messages').appendChild(div)
  }
  div.innerText = text + (streaming ? '█' : '')
}
</script>
</body>
</html>
